<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Stock Management | Nairobi Distillers</title>
  <style>
    body { font-family: Arial, sans-serif; background: #000; color: #fff; margin: 0; padding: 0; }
    header { background: #111; padding: 20px; text-align: center; font-size: 28px; font-weight: bold; border-bottom: 2px solid #444; }
    .container { max-width: 900px; margin: 40px auto; background: #111; padding: 20px; border-radius: 10px; border: 1px solid #333; }
    h2 { border-left: 4px solid white; padding-left: 10px; }
    form { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
    input, select, button { padding: 10px; border-radius: 5px; border: none; width: 100%; }
    input, select { background: #222; color: #fff; }
    button { background: #fff; color: #000; font-weight: bold; cursor: pointer; grid-column: span 2; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { padding: 12px; border: 1px solid #333; text-align: left; }
    th { background: #222; }
    @media (max-width: 600px) { form { grid-template-columns: 1fr; } button { grid-column: span 1; } table, th, td { font-size: 14px; } }
  </style>
</head>
<body>
  <header>Nairobi Distillers | Stock Management System</header>

  <div class="container">
    <h2>Add / Remove Stock</h2>
    <form id="stockForm">
      <input type="text" id="itemName" placeholder="Item" required />
      <input type="number" id="quantity" placeholder="Quantity" required />
      <input type="text" id="person" placeholder="Name" required />
      <input type="text" id="purpose" placeholder="Purpose of Item" required />
      <select id="action" required>
        <option value="add">Add to Stock</option>
        <option value="remove">Remove from Stock</option>
      </select>
      <button type="submit">Submit</button>
    </form>

    <h2>Search Records</h2>
    <input type="text" id="search" placeholder="Search item, person, purpose..." style="width:100%;margin-bottom:10px;background:#222;color:white;padding:10px;border-radius:5px;" />

    <h2>Stock Records</h2>
    <table>
      <thead>
        <tr>
          <th>Item</th>
          <th>Qty</th>
          <th>Action</th>
          <th>Person</th>
          <th>Purpose</th>
          <th>Time</th>
          <th>Edit</th>
          <th>Delete</th>
        </tr>
      </thead>
      <tbody id="records"></tbody>
    </table>

    <h2>Current Stock Balance</h2>
    <table>
      <thead>
        <tr><th>Item</th><th>Balance</th></tr>
      </thead>
      <tbody id="balance"></tbody>
    </table>

    <button onclick="exportExcel()">Export Excel</button>
    <button onclick="exportPDF()">Export PDF</button>
  </div>

  <script>
    const form = document.getElementById('stockForm');
    const recordsTable = document.getElementById('records');
    const balanceTable = document.getElementById('balance');
    const search = document.getElementById('search');

    let records = JSON.parse(localStorage.getItem('records')) || [];

    function saveRecords() { localStorage.setItem('records', JSON.stringify(records)); }

    function refreshTables() {
      recordsTable.innerHTML = '';
      balanceTable.innerHTML = '';
      let balance = {};

      records.forEach((r, i) => {
        recordsTable.innerHTML += `<tr>
          <td>${r.item}</td>
          <td>${r.qty}</td>
          <td>${r.action}</td>
          <td>${r.person}</td>
          <td>${r.purpose}</td>
          <td>${r.time}</td>
          <td><button onclick="editRecord(${i})">Edit</button></td>
          <td><button onclick="deleteRecord(${i})">Delete</button></td>
        </tr>`;

        if (!balance[r.item]) balance[r.item] = 0;
        balance[r.item] += r.action === 'add' ? Number(r.qty) : -Number(r.qty);
      });

      Object.keys(balance).forEach(item => {
        balanceTable.innerHTML += `<tr><td>${item}</td><td>${balance[item]}</td></tr>`;
      });
    }

    form.addEventListener('submit', function(e) {
      e.preventDefault();
      const newRecord = {
        item: itemName.value,
        qty: quantity.value,
        person: person.value,
        purpose: purpose.value,
        action: action.value,
        time: new Date().toLocaleString()
      };
      records.push(newRecord);
      saveRecords();
      refreshTables();
      form.reset();
    });

    function deleteRecord(i) {
      records.splice(i, 1);
      saveRecords();
      refreshTables();
    }

    function editRecord(i) {
      let r = records[i];
      itemName.value = r.item;
      quantity.value = r.qty;
      person.value = r.person;
      purpose.value = r.purpose;
      action.value = r.action;
      deleteRecord(i);
    }

    search.addEventListener('input', function() {
      const q = search.value.toLowerCase();
      const rows = recordsTable.getElementsByTagName('tr');
      for (let r of rows) {
        const text = r.innerText.toLowerCase();
        r.style.display = text.includes(q) ? '' : 'none';
      }
    });

    function exportExcel() {
      const csv = records.map(r => `${r.item},${r.qty},${r.action},${r.person},${r.purpose},${r.time}`).join('\n');
      const blob = new Blob([csv], { type: 'text/csv' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'stock_records.csv'; a.click();
    }

    function exportPDF() { alert("PDF export will be added later."); }

    refreshTables();
  </script>
</body>
</html>
