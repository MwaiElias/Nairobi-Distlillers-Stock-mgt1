<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Stock Management | Nairobi Distillers</title>
  <style>
    body { font-family: Arial, sans-serif; background: #000; color: #fff; margin: 0; padding: 0; }
    header { background: #111; padding: 20px; text-align: center; font-size: 28px; font-weight: bold; border-bottom: 2px solid #444; }
    .container { max-width: 900px; margin: 40px auto; background: #111; padding: 20px; border-radius: 10px; border: 1px solid #333; }
    h2 { border-left: 4px solid white; padding-left: 10px; }
    form { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
    input, select, button { padding: 10px; border-radius: 5px; border: none; width: 100%; }
    input, select { background: #222; color: #fff; }
    button { background: #fff; color: #000; font-weight: bold; cursor: pointer; grid-column: span 2; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { padding: 12px; border: 1px solid #333; text-align: left; }
    th { background: #222; }
    #recordsContainer { display: none; }
    @media (max-width: 600px) { form { grid-template-columns: 1fr; } button { grid-column: span 1; } table, th, td { font-size: 14px; } }
  </style>
</head>
<body>
  <header>Nairobi Distillers | Stock Management System</header>

  <div class="container">
    <h2>Add / Remove Stock</h2>
    <form id="stockForm">
      <input type="text" id="itemName" placeholder="Item" required />
      <input type="number" id="quantity" placeholder="Quantity" required />
      <input type="text" id="person" placeholder="Name" required />
      <input type="text" id="purpose" placeholder="Purpose of Item" required />
      <select id="action" required>
        <option value="add">Add to Stock</option>
        <option value="remove">Remove from Stock</option>
      </select>
      <button type="submit">Submit</button>
    </form>

    <h2>Search Item Records</h2>
    <input type="text" id="search" placeholder="Enter item name to see all entries" style="width:100%;margin-bottom:10px;background:#222;color:white;padding:10px;border-radius:5px;" />

    <div id="recordsContainer">
      <h2>Stock Records for Item</h2>
      <table>
        <thead>
          <tr>
            <th>Qty</th>
            <th>Action</th>
            <th>Person</th>
            <th>Purpose</th>
            <th>Time</th>
          </tr>
        </thead>
        <tbody id="records"></tbody>
      </table>
    </div>

    <h2>Current Stock Balance</h2>
    <table>
      <thead>
        <tr><th>Item</th><th>Balance</th></tr>
      </thead>
      <tbody id="balance"></tbody>
    </table>

    <button onclick="exportExcel()">Export Excel</button>
    <button onclick="exportPDF()">Export PDF</button>
  </div>

  <script>
    const form = document.getElementById('stockForm');
    const recordsTable = document.getElementById('records');
    const recordsContainer = document.getElementById('recordsContainer');
    const balanceTable = document.getElementById('balance');
    const search = document.getElementById('search');

    let records = JSON.parse(localStorage.getItem('records')) || [];

    if (records.length === 0) {
      const initialItems = ['sisal strings','Mocha Leather','Tan Leather','700ml bottles','1litre plastic bottle'];
      const now = new Date().toLocaleString();
      initialItems.forEach(item => {
        records.push({item:item, qty:0, action:'add', person:'System', purpose:'Initial Load', time:now});
      });
      localStorage.setItem('records', JSON.stringify(records));
    }

    function saveRecords() { localStorage.setItem('records', JSON.stringify(records)); }

    function refreshTables() {
      balanceTable.innerHTML = '';
      let balance = {};

      records.forEach(r => {
        if (!balance[r.item]) balance[r.item] = 0;
        balance[r.item] += r.action === 'add' ? Number(r.qty) : -Number(r.qty);
      });

      Object.keys(balance).forEach(item => {
        balanceTable.innerHTML += `<tr><td>${item}</td><td>${balance[item]}</td></tr>`;
      });
    }

    form.addEventListener('submit', function(e) {
      e.preventDefault();
      const newItemInput = itemName.value.toLowerCase();
      const newQty = Number(quantity.value);
      const newPerson = person.value;
      const newPurpose = purpose.value;
      const newAction = action.value;
      const now = new Date().toLocaleString();

      // Record exactly what the user entered for this action
      records.push({item:itemName.value, qty:newQty, action:newAction, person:newPerson, purpose:newPurpose, time:now});

      saveRecords();
      refreshTables();
      form.reset();
    });

    search.addEventListener('input', function() {
      const q = search.value.toLowerCase();
      const filtered = records.filter(r => r.item.toLowerCase().includes(q));

      recordsTable.innerHTML = '';
      if (filtered.length > 0) {
        recordsContainer.style.display = 'block';
        filtered.forEach(r => {
          // Display quantity exactly as entered by the user
          recordsTable.innerHTML += `<tr><td>${r.qty}</td><td>${r.action}</td><td>${r.person}</td><td>${r.purpose}</td><td>${r.time}</td></tr>`;
        });
      } else {
        recordsContainer.style.display = 'none';
      }
    });

    function exportExcel() { const csv = records.map(r => `${r.item},${r.qty},${r.action},${r.person},${r.purpose},${r.time}`).join('\n'); const blob = new Blob([csv], { type: 'text/csv' }); const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = 'stock_records.csv'; a.click(); }
    function exportPDF() { alert("PDF export will be added later."); }

    refreshTables();
  </script>
</body>
</html>
